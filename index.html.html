<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#6b21a8">
    <meta name="description" content="Controle suas despesas de forma simples e eficiente">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Minhas Despesas</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen">
    <div id="app"></div>

    <script>
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').then(function(registration) {
                console.log('Service Worker registrado com sucesso:', registration);
            }).catch(function(error) {
                console.log('Falha ao registrar Service Worker:', error);
            });
        }

        // Ícones SVG
        const icons = {
            dollarSign: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>',
            trendingDown: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"></polyline><polyline points="17 18 23 18 23 12"></polyline></svg>',
            calendar: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>',
            plus: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>',
            trash: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>',
            download: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>',
            upload: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>'
        };

        // Categorias
        const categories = {
            alimentacao: { name: 'Alimentação', color: 'bg-orange-500' },
            transporte: { name: 'Transporte', color: 'bg-blue-500' },
            moradia: { name: 'Moradia', color: 'bg-green-500' },
            saude: { name: 'Saúde', color: 'bg-red-500' },
            lazer: { name: 'Lazer', color: 'bg-purple-500' },
            educacao: { name: 'Educação', color: 'bg-indigo-500' },
            outros: { name: 'Outros', color: 'bg-gray-500' }
        };

        // Estado da aplicação
        let state = {
            expenses: [],
            description: '',
            amount: '',
            category: 'alimentacao',
            date: new Date().toISOString().split('T')[0]
        };

        // Carregar dados do localStorage
        function loadData() {
            const saved = localStorage.getItem('expenses');
            if (saved) {
                state.expenses = JSON.parse(saved);
            }
        }

        // Salvar dados no localStorage
        function saveData() {
            localStorage.setItem('expenses', JSON.stringify(state.expenses));
        }

        // Adicionar despesa
        function addExpense() {
            if (!state.description || !state.amount) {
                alert('Por favor, preencha a descrição e o valor!');
                return;
            }

            const newExpense = {
                id: Date.now(),
                description: state.description,
                amount: parseFloat(state.amount),
                category: state.category,
                date: state.date
            };

            state.expenses.unshift(newExpense);
            state.description = '';
            state.amount = '';
            state.category = 'alimentacao';
            state.date = new Date().toISOString().split('T')[0];
            
            saveData();
            render();
        }

        // Deletar despesa
        function deleteExpense(id) {
            if (confirm('Tem certeza que deseja excluir esta despesa?')) {
                state.expenses = state.expenses.filter(exp => exp.id !== id);
                saveData();
                render();
            }
        }

        // Exportar dados
        function exportData() {
            const data = JSON.stringify(state.expenses, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `despesas_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Importar dados
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'application/json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        if (confirm('Isso vai substituir todos os dados atuais. Continuar?')) {
                            state.expenses = data;
                            saveData();
                            render();
                            alert('Dados importados com sucesso!');
                        }
                    } catch (error) {
                        alert('Erro ao importar dados. Arquivo inválido.');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // Calcular totais
        function getTotalExpenses() {
            return state.expenses.reduce((sum, exp) => sum + exp.amount, 0);
        }

        function getExpensesByCategory() {
            return state.expenses.reduce((acc, exp) => {
                acc[exp.category] = (acc[exp.category] || 0) + exp.amount;
                return acc;
            }, {});
        }

        // Renderizar aplicação
        function render() {
            const total = getTotalExpenses();
            const byCategory = getExpensesByCategory();

            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="max-w-4xl mx-auto p-4">
                    <!-- Header -->
                    <div class="text-center mb-8 pt-6">
                        <h1 class="text-4xl font-bold text-white mb-2 flex items-center justify-center gap-3">
                            <span class="w-10 h-10">${icons.dollarSign}</span>
                            Minhas Despesas
                        </h1>
                        <p class="text-purple-200">Controle seus gastos de forma simples</p>
                    </div>

                    <!-- Summary Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div class="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-purple-200 text-sm mb-1">Total de Despesas</p>
                                    <p class="text-3xl font-bold text-white">R$ ${total.toFixed(2)}</p>
                                </div>
                                <span class="w-12 h-12 text-red-400">${icons.trendingDown}</span>
                            </div>
                        </div>
                        
                        <div class="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-purple-200 text-sm mb-1">Registros</p>
                                    <p class="text-3xl font-bold text-white">${state.expenses.length}</p>
                                </div>
                                <span class="w-12 h-12 text-blue-400">${icons.calendar}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Export/Import Buttons -->
                    <div class="flex gap-3 mb-6">
                        <button onclick="exportData()" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-4 rounded-lg transition-all flex items-center justify-center gap-2">
                            <span class="w-5 h-5">${icons.download}</span>
                            Exportar Dados
                        </button>
                        <button onclick="importData()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition-all flex items-center justify-center gap-2">
                            <span class="w-5 h-5">${icons.upload}</span>
                            Importar Dados
                        </button>
                    </div>

                    <!-- Add Expense Form -->
                    <div class="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20 mb-6">
                        <h2 class="text-xl font-semibold text-white mb-4 flex items-center gap-2">
                            <span class="w-5 h-5">${icons.plus}</span>
                            Adicionar Despesa
                        </h2>
                        <div class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <input
                                    type="text"
                                    id="description"
                                    placeholder="Descrição da despesa"
                                    value="${state.description}"
                                    class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 text-white placeholder-purple-200 focus:outline-none focus:ring-2 focus:ring-purple-400"
                                />
                                <input
                                    type="number"
                                    id="amount"
                                    step="0.01"
                                    placeholder="Valor (R$)"
                                    value="${state.amount}"
                                    class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 text-white placeholder-purple-200 focus:outline-none focus:ring-2 focus:ring-purple-400"
                                />
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <select
                                    id="category"
                                    class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 text-white focus:outline-none focus:ring-2 focus:ring-purple-400"
                                >
                                    ${Object.entries(categories).map(([key, cat]) => 
                                        `<option value="${key}" ${state.category === key ? 'selected' : ''} style="background-color: #1e293b;">${cat.name}</option>`
                                    ).join('')}
                                </select>
                                <input
                                    type="date"
                                    id="date"
                                    value="${state.date}"
                                    class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 text-white focus:outline-none focus:ring-2 focus:ring-purple-400"
                                />
                            </div>
                            <button
                                onclick="addExpense()"
                                class="w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 flex items-center justify-center gap-2"
                            >
                                <span class="w-5 h-5">${icons.plus}</span>
                                Adicionar Despesa
                            </button>
                        </div>
                    </div>

                    <!-- Category Summary -->
                    ${state.expenses.length > 0 ? `
                        <div class="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20 mb-6">
                            <h2 class="text-xl font-semibold text-white mb-4">Despesas por Categoria</h2>
                            <div class="space-y-3">
                                ${Object.entries(byCategory).map(([cat, amount]) => `
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-3">
                                            <div class="w-3 h-3 rounded-full ${categories[cat].color}"></div>
                                            <span class="text-purple-100">${categories[cat].name}</span>
                                        </div>
                                        <span class="text-white font-semibold">R$ ${amount.toFixed(2)}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}

                    <!-- Expenses List -->
                    <div class="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20">
                        <h2 class="text-xl font-semibold text-white mb-4">Histórico de Despesas</h2>
                        ${state.expenses.length === 0 ? `
                            <p class="text-purple-200 text-center py-8">
                                Nenhuma despesa registrada ainda. Adicione sua primeira despesa acima!
                            </p>
                        ` : `
                            <div class="space-y-3">
                                ${state.expenses.map(expense => `
                                    <div class="bg-white/5 rounded-lg p-4 flex items-center justify-between hover:bg-white/10 transition-colors">
                                        <div class="flex items-center gap-4 flex-1">
                                            <div class="w-2 h-12 rounded-full ${categories[expense.category].color}"></div>
                                            <div class="flex-1">
                                                <p class="text-white font-medium">${expense.description}</p>
                                                <div class="flex gap-4 mt-1">
                                                    <span class="text-sm text-purple-200">${categories[expense.category].name}</span>
                                                    <span class="text-sm text-purple-200">${new Date(expense.date + 'T00:00:00').toLocaleDateString('pt-BR')}</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-4">
                                            <span class="text-xl font-bold text-white">R$ ${expense.amount.toFixed(2)}</span>
                                            <button
                                                onclick="deleteExpense(${expense.id})"
                                                class="text-red-400 hover:text-red-300 transition-colors p-2 hover:bg-red-500/20 rounded-lg"
                                            >
                                                <span class="w-5 h-5 inline-block">${icons.trash}</span>
                                            </button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `}
                    </div>
                </div>
            `;

            // Adicionar event listeners
            document.getElementById('description').addEventListener('input', (e) => {
                state.description = e.target.value;
            });
            document.getElementById('amount').addEventListener('input', (e) => {
                state.amount = e.target.value;
            });
            document.getElementById('category').addEventListener('change', (e) => {
                state.category = e.target.value;
            });
            document.getElementById('date').addEventListener('change', (e) => {
                state.date = e.target.value;
            });
        }

        // Inicializar aplicação
        loadData();
        render();
    </script>
</body>
</html>